#!/usr/bin/env python

import wsgiref.handlers
from google.appengine.ext import ndb
from google.appengine.ext import webapp
from google.appengine.ext.webapp \
     import template

class Shout(ndb.Model):
    message = ndb.StringProperty(
        required=True)
    when = ndb.DateTimeProperty(
        auto_now_add=True)

class MyHandler(webapp.RequestHandler):
    def get(self):
        shouts = ndb.gql(
        'SELECT * FROM Shout')
        values = {
            'shouts':shouts
        }
        self.response.out.write(
          template.render('main.html',values))
    def post(self):
        shout = Shout(
        message=self.request.get(
            'message'))
        shout.put()
        self.redirect('/')
 
def main():
    app = webapp.WSGIApplication([
        (r'.*',MyHandler)], debug=True)
    wsgiref.handlers.CGIHandler().run(app)

if __name__ == "__main__":
    main()